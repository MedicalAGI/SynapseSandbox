(self.webpackChunkprompt_flow_client=self.webpackChunkprompt_flow_client||[]).push([[502],{3502:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>He});var r=n(6697),l=n(1825),o=n(5400),a=n(1187),u=n(7538),i=n(8481),c=n(7294),s=n(4184),d=n.n(s),f=n(5877),v=n(671);const p={container:"U6e2-",button:"_1xpTj",modal:"_19hIs",drawer:"_2UC-o",templateDrawer:"_33S-i"};var m,y,h=["name","type","template","input"],g=h.map((function(e){return{key:e}}));!function(e){e.process="process",e.policy="policy",e.search="search"}(m||(m={})),function(e){e.validKey="valid_key",e.validValue="valid_value"}(y||(y={}));var w=n(6156),E=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t},b={isDrawerVisible:!1,setDrawerVisible:E,previewTitle:"",previewContent:"",setPreviewTitle:E,setPreviewContent:E,addFieldKey:0,setAddFieldKey:E,template:{},setTemplate:E,option:{},setOption:E,nodesOutput:[],setNodesOutput:E,isClickOutput:!1,setIsClickOutput:E,outputFieldKey:0,setOutputFieldKey:E},Z=(0,c.createContext)(b),O=function(e){var t=e.children,n=(0,c.useState)(!1),r=(0,i.Z)(n,2),l=r[0],o=r[1],a=(0,c.useState)(""),u=(0,i.Z)(a,2),s=u[0],d=u[1],f=(0,c.useState)(""),v=(0,i.Z)(f,2),p=v[0],m=v[1],y=(0,c.useState)(0),h=(0,i.Z)(y,2),g=h[0],w=h[1],E=(0,c.useState)(),b=(0,i.Z)(E,2),O=b[0],k=b[1],C=(0,c.useState)(),P=(0,i.Z)(C,2),j=P[0],_=P[1],N=(0,c.useState)([]),S=(0,i.Z)(N,2),F=S[0],x=S[1],D=(0,c.useState)(!1),V=(0,i.Z)(D,2),R=V[0],T=V[1],I=(0,c.useState)(0),K=(0,i.Z)(I,2),L=K[0],A=K[1],q=(0,c.useMemo)((function(){return{isDrawerVisible:l,setDrawerVisible:o,previewTitle:s,setPreviewTitle:d,previewContent:p,setPreviewContent:m,addFieldKey:g,setAddFieldKey:w,template:O,setTemplate:k,option:j,setOption:_,nodesOutput:F,setNodesOutput:x,isClickOutput:R,setIsClickOutput:T,outputFieldKey:L,setOutputFieldKey:A}}),[g,R,l,F,j,L,p,s,O]);return c.createElement(Z.Provider,{value:q},t)};function k(){return(0,c.useContext)(Z)}var C=["#e0c99d","#e0e4b4","#bcc9af","#8fd1a2","#92bbe0","#7f89d5","#87CEFA","#B0E0E6"];const P="_3UQob",j="_1lf_u",_="_3w17t";var N=n(4055),S=n(1870),F=n(5357),x=n(9165),D=n(3171);const V="_1Xyij",R="_3Ok8t",T="f6uT4",I="_21X4P";var K=n(1535),L=n(1024),A=n(5673),q=n(4749),J=n(5596),U=n(5789);const B=function(e){var t=e.cols;return c.createElement(c.Fragment,null,c.createElement(U.default,{span:7},t[0]),c.createElement(U.default,{span:13},t[1]),c.createElement(U.default,{span:4},t[2]))},H="_10Dkz",W="_27Fxt",G="WXs-a",X="aCKsT",z="_2uwRG",M="asPRV",Y="_3Phqj";var Q=n(3027),$=q.Z.Option;const ee=function(e){var t=e.fieldKey,n=e.form,r=(0,c.useRef)(null),l=k(),a=l.setDrawerVisible,i=l.setPreviewTitle,s=l.setPreviewContent,d=l.option,f=l.template;return c.createElement(u.Z.List,{name:[t,"content"]},(function(e,l){var p=l.add,g=l.remove;return c.createElement("div",{className:H},c.createElement("div",{className:W},c.createElement(A.default,{className:G},c.createElement(B,{cols:["Key","Value","Action"]})),c.createElement("div",{className:X,ref:r},e.map((function(e){var r=e.key,l=e.name,p=0===t?l<h.length:l<h.length-1,w=1===l,E=2===l;return c.createElement(A.default,{className:z,key:r},c.createElement(B,{cols:[c.createElement(c.Fragment,null,c.createElement(u.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){var r,o,a,u,i,c,s,d;return(null==e||null===(r=e.nodes)||void 0===r||null===(o=r[t])||void 0===o||null===(a=o.content)||void 0===a||null===(u=a[l-2])||void 0===u?void 0:u.value)!==(null==n||null===(i=n.nodes)||void 0===i||null===(c=i[t])||void 0===c||null===(s=c.content)||void 0===s||null===(d=s[l-2])||void 0===d?void 0:d.value)}},(function(e){return(0,e.getFieldValue)(["nodes",t,"content",l-2,"value"])===m.policy&&0!==t?c.createElement(u.Z.Item,{key:"key",name:[l,"key"],rules:[{required:!0,message:"key is required"}]},c.createElement(q.Z,{allowClear:!0,placeholder:"valid key",style:{width:80}},Object.keys(y).map((function(e){return c.createElement($,{value:y[e],key:e,label:e},e)})))):c.createElement(u.Z.Item,{key:"key",name:[l,"key"],rules:[{required:!0,message:"key is required"}]},c.createElement(L.Z,{readOnly:p,placeholder:"Input Key",style:p?{border:"none",outline:"none",boxShadow:"none"}:void 0}))}))),c.createElement(c.Fragment,null,c.createElement(u.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){var r,o,a,u,i,c,s,d;return(null==e||null===(r=e.nodes)||void 0===r||null===(o=r[t])||void 0===o||null===(a=o.content)||void 0===a||null===(u=a[l-1])||void 0===u?void 0:u.value)!==(null==n||null===(i=n.nodes)||void 0===i||null===(c=i[t])||void 0===c||null===(s=c.content)||void 0===s||null===(d=s[l-1])||void 0===d?void 0:d.value)}},(function(e){var n=e.getFieldValue;return E&&c.createElement(u.Z.Item,{key:"value",name:[l,"value"],style:{width:"100%"},rules:[{required:n(["nodes",t,"content",l-1,"value"])===m.policy,message:"template is required"}]},c.createElement(K.Z,{loading:(0,v.Z)(d)||(0,J.Z)(d),options:d,showSearch:!0,placeholder:"select template",dropdownRender:function(e){return c.createElement(Q.Z,{spinning:(0,v.Z)(d)||(0,J.Z)(d)},e)},displayRender:function(e){return e.pop()}}))})),w&&c.createElement(u.Z.Item,{key:"value",name:[l,"value"],style:{width:"100%"},rules:[{required:!0,message:"type is required"}]},c.createElement(q.Z,{allowClear:!0,placeholder:"select node type"},Object.keys(m).map((function(e){return c.createElement($,{value:m[e],key:e,label:e},e)})))),c.createElement(u.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){var r,o,a,u,i,c,s,d;return(null==e||null===(r=e.nodes)||void 0===r||null===(o=r[t])||void 0===o||null===(a=o.content)||void 0===a||null===(u=a[l])||void 0===u?void 0:u.key)!==(null==n||null===(i=n.nodes)||void 0===i||null===(c=i[t])||void 0===c||null===(s=c.content)||void 0===s||null===(d=s[l])||void 0===d?void 0:d.key)}},(function(e){var n=e.getFieldValue,r=Object.values(y).includes(n(["nodes",t,"content",l,"key"]));return E||w?null:r?c.createElement(u.Z.Item,{key:"value",name:[l,"value"],style:{width:"100%"},rules:[{required:!0,message:"template is required"}]},c.createElement(q.Z,{mode:"tags",style:{width:"100%"},placeholder:"Input Values",dropdownRender:function(e){return c.createElement("div",{className:Y},"Input Values and enter",e)}})):c.createElement(u.Z.Item,{key:"value",name:[l,"value"],style:{width:"100%"},rules:[{required:!0,message:"value is required"}]},c.createElement(L.Z,{placeholder:"Input Value",style:{width:"100%"}}))}))),c.createElement(c.Fragment,null,c.createElement(o.default,{disabled:p,key:"action",icon:c.createElement(D.Z,null),onClick:function(){return g(l)},style:{marginRight:8}}),E&&c.createElement(N.default,{title:"Preview Template"},c.createElement(o.default,{key:"action",style:{width:20},icon:c.createElement(F.Z,null),onClick:function(){var e=n.getFieldValue(["nodes",t,"content",l,"value"]).join("/");a(!0),i("Node_".concat(t+1," template preview")),(0,J.Z)(f)||(0,v.Z)(f)?s("Please Select a Template First"):s(null==f?void 0:f[e])}})))]}))})))),c.createElement("div",{className:M},c.createElement(o.default,{type:"link",onClick:function(){p(),setTimeout((function(){r.current&&r.current.scrollTo({top:r.current.scrollHeight,behavior:"smooth"})}),30)}},"+ Add New Key")))}))};const te=function(e){var t=e.form,n=e.fieldKey,r=e.isLoading,l=e.onAddNode,o=void 0===l?E:l,a=e.onDeleteNode,i=void 0===a?E:a,s=(0,c.useRef)(null),d=k(),f=d.setIsClickOutput,v=d.setOutputFieldKey,p=d.nodesOutput,m=d.setDrawerVisible,y=d.setPreviewTitle,h=d.setPreviewContent;return c.createElement("div",{key:n,className:V,style:{border:"10px solid ".concat(C[n%C.length])}},c.createElement("div",{className:R},c.createElement(u.Z.Item,{label:"",noStyle:!0,style:{height:40}},c.createElement("span",{style:{marginLeft:10}},"Node".concat(n+1),c.createElement(N.default,{overlayClassName:I,title:c.createElement("span",{style:{color:"#333333"}},"This is a prompt node.")},c.createElement(S.Z,{style:{marginLeft:4}})))),c.createElement(u.Z.Item,{noStyle:!0},c.createElement("div",null,c.createElement(N.default,{title:r?"running flow":"Node output Preview"},c.createElement(F.Z,{onClick:function(){if(!r)if(p[n]){var e,t,l,o;m(!0),y("Node_".concat(n+1," output preview"));var a=null!==(e=p[n])&&void 0!==e&&e.extra_output?"output:".concat(null===(t=p[n])||void 0===t?void 0:t.output,"\nextract output: ").concat(null===(l=p[n])||void 0===l?void 0:l.extra_output):null===(o=p[n])||void 0===o?void 0:o.output;h(a)}else f(!0),v(n)},style:{marginRight:10,cursor:r?"not-allowed":"pointer"}})),c.createElement(N.default,{title:"Copy"},c.createElement(x.Z,{onClick:function(){var e,r,l,a,u,i;o(0===n?{content:[{key:"name",value:""}].concat(null===(e=t.getFieldValue(["nodes",n]))||void 0===e||null===(r=e.content)||void 0===r?void 0:r.slice(1,3)).concat(null===(l=t.getFieldValue(["nodes",n]))||void 0===l||null===(a=l.content)||void 0===a?void 0:a.slice(4))}:{content:[{key:"name",value:""}].concat(null===(u=t.getFieldValue(["nodes",n]))||void 0===u||null===(i=u.content)||void 0===i?void 0:i.slice(1))})},style:{marginRight:10}})),c.createElement(N.default,{title:"Delete"},c.createElement(D.Z,{onClick:function(){i(n)},style:{marginRight:10}}))))),c.createElement("div",{className:T,ref:s},c.createElement(ee,{form:t,rootRef:s,fieldKey:n})))};const ne=function(e){var t=e.form,n=e.isLoading,l=e.onDelete,a=(0,c.useRef)(null),s=k(),f=s.setDrawerVisible,v=s.setAddFieldKey,p=(0,c.useState)(!1),m=(0,i.Z)(p,2),y=m[0],h=m[1],E=(0,c.useState)(),b=(0,i.Z)(E,2),Z=b[0],O=b[1],N=function(e){h(!0),O(e)};return c.createElement("div",{className:d()(P,(0,w.Z)({},j,!1)),ref:a},c.createElement(u.Z.List,{name:["nodes"]},(function(e,r){var l=r.add;return c.createElement(c.Fragment,null,c.createElement("div",{style:{display:"flex",flexWrap:"wrap"}},e.map((function(e){var r,o=e.key;return v(o),c.createElement("div",{style:{display:"flex"},key:o},c.createElement(te,{key:o,fieldKey:o,form:t,rootRef:a,onAddNode:l,onDeleteNode:N,isLoading:n}),o!==(null===(r=t.getFieldValue("nodes"))||void 0===r?void 0:r.length)-1&&c.createElement(c.Fragment,null,c.createElement("div",{style:{height:24,background:C[o],marginTop:210,width:48,justifyContent:"center"}})))}))),c.createElement(u.Z.Item,null,c.createElement(o.default,{type:"primary",onClick:function(){f(!1),l({content:g.slice(0,3)})}},"+ Add New Node")))})),c.createElement(r.Z,{title:"Notice",visible:y,onOk:function(){h(!1),l(Z||0)},onCancel:function(){return h(!1)},className:_},0===Z&&1===t.getFieldValue("nodes").length?"This is the only node, delete will create a new empty node.":"Are you sure to delete this Node Configuration?"))};function re(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function le(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?re(Object(n),!0).forEach((function(t){(0,w.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):re(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var oe=function(e,t){return null==e?void 0:e.map((function(e){return e.reduce((function(e,n){if("template"===(null==n?void 0:n.key)){var r,l=null==n||null===(r=n.value)||void 0===r?void 0:r.join("/");return le(le({},e),{},(0,w.Z)({},null==n?void 0:n.key,null==t?void 0:t[l]))}return le(le({},e),{},(0,w.Z)({},null==n?void 0:n.key,null==n?void 0:n.value))}),{})}))},ae=n(302),ue=n(2122),ie=n(1253);const ce="MrKsK";const se=function(e){var t=e.children,n=e.className,r=(0,ie.Z)(e,["children","className"]);return c.createElement(ae.Z,(0,ue.Z)({bordered:!1,className:d()(ce,n)},r),t)};var de=n(4981),fe=n(7180),ve=n(7563);n(2477),n(2557);function pe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function me(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pe(Object(n),!0).forEach((function(t){(0,w.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ye=function(e,t){var n=e.value,r=e.defaultValue,l=e.jsYamlLoadOptions,o=e.validateDelay,a=void 0===o?500:o,u=e.name,i=void 0===u?"yaml-editor":u,s=e.onJsValueChange,d=void 0===s?E:s,f=e.onLoad,v=(0,ie.Z)(e,["value","defaultValue","jsYamlLoadOptions","validateDelay","name","onJsValueChange","onLoad"]),p=(0,c.useRef)(),m=(0,c.useRef)(),y=(0,c.useCallback)((function(e){p.current=e,m.current=e.getSession(),f&&f(e)}),[f]),h=(0,ve.Z)((function(e){var t=me(me({},{onWarning:function(e){console.log("onWarning",e)}}),l);try{var n=fe.ZP.load(e,t);d(n),m.current&&m.current.setAnnotations([])}catch(e){var r,o;if(m.current)m.current.setAnnotations([{column:(null===(r=e.mark)||void 0===r?void 0:r.column)||0,row:(null===(o=e.mark)||void 0===o?void 0:o.line)||0,type:"error",text:e.message}])}}),a);return(0,c.useEffect)((function(){(0,J.Z)(n)?(0,J.Z)(r)||h(r):h(n)}),[r,h,n]),(0,c.useImperativeHandle)(t,(function(){return p.current})),c.createElement(de.ZP,(0,ue.Z)({},v,{value:n,defaultValue:r,mode:"yaml",theme:"tomorrow",name:i,editorProps:{$blockScrolling:!0},onLoad:y}))};const he=(0,c.forwardRef)(ye);var ge=n(2137),we=n(7757),Ee=n.n(we),be=n(4301),Ze=n.n(be),Oe=n(6610),ke=n(379),Ce=n(6070),Pe=n(7608),je=n(2317),_e=n(4322);function Ne(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,Pe.Z)(e);if(t){var l=(0,Pe.Z)(this).constructor;n=Reflect.construct(r,arguments,l)}else n=r.apply(this,arguments);return(0,Ce.Z)(this,n)}}var Se,Fe=function(e){(0,ke.Z)(n,e);var t=Ne(n);function n(e){var r;(0,Oe.Z)(this,n);var l,o=e.body,a=e.code,u=e.method,i=e.resource;try{l=_e.getStatusText(a)}catch(e){l="Failed to fetch"}return(r=t.call(this,(null==o?void 0:o.message)||l)).title="".concat(a||"error"),r.body=o,r.code=a,r.method=u,r.resource=i,r}return n}((0,je.Z)(Error)),xe=function(e){return"".concat(e).startsWith("4")||"".concat(e).startsWith("5")};function De(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ve(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?De(Object(n),!0).forEach((function(t){(0,w.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):De(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e.unspecified="unspecified",e.applicationJson="application/json",e.textPlain="text/plain",e.textHtml="text/html"}(Se||(Se={}));var Re=function(e,t){return(0,J.Z)(t)||"applicationJson"!==e?t:JSON.stringify(t)},Te=function(e,t){var n;return null===(n=e.headers.get("Content-Type"))||void 0===n?void 0:n.toLocaleLowerCase().includes(t)},Ie=function(e){var t=e.server,n=e.prefix,r=e.version,l=void 0===r?"v1":r,o=e.resource,a=e.params,u=t||"";return u+=n?"/".concat(n):"",u+=l?"/".concat(l):"",u+=o?"/".concat(o):"",u+=function(e){var t="";if(e){var n=new window.URLSearchParams;Object.entries(e).filter((function(e){var t=(0,i.Z)(e,2)[1];return!(0,J.Z)(t)})).forEach((function(e){var t=(0,i.Z)(e,2),r=t[0],l=t[1];Array.isArray(l)?l.forEach((function(e){n.append(r,e)})):n.append(r,l)})),t=n.toString()}return t&&"?".concat(t)}(a)},Ke=function(){var e=(0,ge.Z)(Ee().mark((function e(t){var n,r,l,o,a,u,i,c,s,d,f,v,p,m,y,h,g,w,E,b;return Ee().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.server,r=void 0===n?"":n,l=t.prefix,o=void 0===l?"":l,a=t.version,u=void 0===a?"":a,i=t.resource,c=t.method,s=void 0===c?"GET":c,d=t.params,f=t.payload,v=t.contentType,p=void 0===v?"applicationJson":v,m=t.credentials,y=void 0===m?"include":m,h=t.headers,g=void 0===h?{}:h,w=Ie({server:r,prefix:o,version:u,resource:i,params:d}),E=Se[p],g=Ve(Ve({},g),{},{"Content-Type":E}),"unspecified"===p&&delete g["Content-Type"],e.abrupt("return",Ze()(w,{method:s,body:Re(p,f),headers:g,credentials:y}).then(function(){var e=(0,ge.Z)(Ee().mark((function e(t){var n,r;return Ee().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b=t.status,n=Te(t,Se.applicationJson),r=n?t.json():t.text(),Te(t,Se.textHtml)&&(r=Promise.resolve("Bad gateway")),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then((function(e){return{status:b,body:e}})).then((function(e){var t=e.body;if(xe(b))throw new Fe({body:t,code:b,method:s,resource:i});return t})).catch((function(e){if(e instanceof Fe)throw e;throw new Fe({body:e,code:b,method:s,resource:i})})));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var Le=Ke,Ae=function(){var e=(0,ge.Z)(Ee().mark((function e(t){var n;return Ee().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le({resource:"api/run_flow",method:"POST",payload:t});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),qe=function(){var e=(0,ge.Z)(Ee().mark((function e(){var t;return Ee().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le({resource:"api/get_templates"});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();var Je={initialLoadingState:!1,enableDefaultErrorHandle:!0,resetResult:!1};const Ue=function(e,t){var n=Object.assign({},Je,t),l=n.enableDefaultErrorHandle,o=n.initialLoadingState,u=n.resetResult,s=(0,c.useState)({loading:o,error:null,result:null}),d=(0,i.Z)(s,2),f=d[0],v=d[1],p=function(){var e=(0,c.useRef)(!1),t=(0,c.useCallback)((function(){return e.current}),[]);return(0,c.useEffect)((function(){return e.current=!0,function(){e.current=!1}})),t}(),m=f.result,y=f.error,h=f.loading,g=(0,c.useCallback)((function(e){if(p()){var t=e.result,n=e.error,r=e.loading;(m!==t||y!==n||h!==r)&&v(e)}}),[y,p,h,m]),w=(0,c.useRef)(g);w.current=g;var E=(0,c.useRef)(m);E.current=m;var b=(0,c.useCallback)((0,ge.Z)(Ee().mark((function t(){var n,r=arguments;return Ee().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return u?w.current({result:null,error:null,loading:!0}):w.current({result:E.current,error:null,loading:!0}),t.prev=1,t.next=4,e.apply(void 0,r);case 4:return n=t.sent,w.current({result:n,error:null,loading:!1}),t.abrupt("return",n);case 9:t.prev=9,t.t0=t.catch(1),w.current({result:E.current,error:t.t0,loading:!1});case 12:return t.abrupt("return",null);case 13:case"end":return t.stop()}}),t,null,[[1,9]])}))),[u,e]);return(0,c.useEffect)((function(){y&&l&&function(e){var t;try{t=_e.getStatusText(e.code)}catch(e){t="Failed to fetch"}"GET"===e.method?a.default.error("[".concat(t,"]: ").concat(e.message)):r.Z.error({title:t,content:e.message})}(y)}),[l,y]),[f,b]};var Be=function(){var e=u.Z.useForm(),t=(0,i.Z)(e,1)[0],n=k(),s=n.setDrawerVisible,m=n.template,y=n.previewTitle,h=n.setPreviewTitle,w=n.isDrawerVisible,E=n.previewContent,b=n.setPreviewContent,Z=n.setTemplate,O=n.setOption,C=n.nodesOutput,P=n.setNodesOutput,j=n.isClickOutput,_=n.outputFieldKey,N=n.setIsClickOutput,S=(0,c.useState)(!1),F=(0,i.Z)(S,2),x=F[0],D=F[1],V=(0,c.useState)(),R=(0,i.Z)(V,2),T=R[0],I=R[1],K=(0,c.useState)(""),L=(0,i.Z)(K,2),A=L[0],q=L[1],J=(0,c.useState)(!1),U=(0,i.Z)(J,2),B=U[0],H=U[1],W=(0,c.useRef)(null),G=Ue(qe),X=(0,i.Z)(G,2),z=X[0].result,M=X[1],Y=Ue(Ae),$=(0,i.Z)(Y,2),ee=$[0],te=ee.result,re=ee.loading,le=$[1];(0,c.useEffect)((function(){m||M()}),[M,m]),(0,c.useEffect)((function(){z&&(Z(z.template),O(z.option))}),[M,O,Z,m,z]),(0,c.useEffect)((function(){return null!=te&&te.running&&(H(!0),s(!1),W.current=window.setInterval((function(){le({flow_id:A,nodes:T})}),500)),function(){W.current&&clearInterval(W.current)}}),[A,null==te?void 0:te.running,T,le]),(0,c.useEffect)((function(){if(te&&(null==te||!te.running)){H(!1),h(j?null!=te&&te.error_message?"Node_".concat(_+1," output error"):"Node_".concat(_+1," output preview"):null!=te&&te.error_message?"Chaining Output Error":"Chaining Output Result");var e="";null!=te&&te.flow_rst&&(e=null==te?void 0:te.flow_rst),null!=te&&te.error&&(e="error message: ".concat(null==te?void 0:te.error_message)),null!=te&&te.stop_flag&&null!=te&&te.stop_node_index&&(e=e+"\n"+"flow is terminated at the node".concat(null==te?void 0:te.stop_node_index)),s(!0),N(!1),b(e),null!=te&&te.node_infos&&!(0,v.Z)(null==te?void 0:te.node_infos)&&P(null==te?void 0:te.node_infos)}}),[te,s,P,b,h]),(0,c.useEffect)((function(){j&&!C[_]&&t.validateFields().then((function(e){var t,n,r=null==e||null===(t=e.nodes)||void 0===t||null===(n=t.slice(0,_+1))||void 0===n?void 0:n.map((function(e){return null==e?void 0:e.content})),l=oe(r,m),o=(0,f.v4)();q(o),I(l),le({flow_id:o,nodes:l})})).catch((function(e){console.warn(e)}))}),[t,j,C,_,le,m]);var ae=(0,c.useCallback)((function(e){var t,n=null==e||null===(t=e.nodes)||void 0===t?void 0:t.map((function(e){return null==e?void 0:e.content})),r=oe(n,m),l=(0,f.v4)();q(l),I(r),le({flow_id:l,nodes:r})}),[le,m]),ue=(0,c.useCallback)((function(e){var t=e.nodes,n=0,r=t.filter(Boolean);t.length!==r.length?(n=t.findIndex((function(e){return Boolean(e)})),(null==C?void 0:C.length)>=n+1&&P(C.slice(0,n))):P([])}),[C,P]);return c.createElement(c.Fragment,null,c.createElement(se,{title:"Prompt Flow",extra:c.createElement("div",{className:p.action},c.createElement(o.default,{className:d()(p.button),onClick:function(){return D(!0)}},"Clear All Nodes"),c.createElement(o.default,{type:"primary",className:d()(p.button),onClick:t.submit,disabled:re||B},"Complete Chaining"))},(re||B)&&c.createElement(Q.Z,null),c.createElement("div",{className:p.container},c.createElement(u.Z,{form:t,onFinish:ae,initialValues:{nodes:[{content:g}]},onValuesChange:ue},c.createElement(ne,{isLoading:re||B,form:t,onDelete:function(e){var n=t.getFieldValue(["nodes"]);if(1===(null==n?void 0:n.length))t.setFieldsValue({nodes:[{content:g}]});else{var r=n.filter((function(t,n){return n!==e}));t.setFields([{name:["nodes"],value:r,errors:void 0}])}a.default.success("Delete Successfully.")}}))),c.createElement(l.Z,{title:y,mask:!1,maskClosable:!1,className:y.includes("template")?p.templateDrawer:p.drawer,placement:"right",onClose:function(){s(!1)},visible:w,width:580,destroyOnClose:!0,headerStyle:{fontSize:8}},c.createElement(he,{value:E,width:"550px",height:"100%"}))),c.createElement(r.Z,{maskClosable:!1,title:"Notice",visible:x,onOk:function(){D(!1),t.resetFields()},onCancel:function(){return D(!1)},className:p.modal},"Are you sure to delete all Nodes?"))};const He=function(){return c.createElement(O,null,c.createElement(Be,null))}}}]);